---
# task install

- name: disable selinux
  selinux:
    state: disabled

- name: install dependencies
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - docker
    - docker-python
    - git

- name: configure docker service
  service:
    name: docker
    enabled: yes
    state: started

- name: clone eyesofindicator git project
  git:
    repo: "{{ eoi_repo }}"
    dest: "{{ eoi_repo_dir }}"
    version: "{{ eoi_version }}"
    update: "{{ eoi_keep_updated }}"
    force: yes
    accept_hostkey: yes

- name: build docker image
  docker_image:
    path: "{{ eoi_repo_dir }}"
    name: "{{ eoi_image }}"
    tag: "{{ eoi_version }}"

- name: run docker container
  docker_container:
    name: "{{ eoi_container }}"
    image: "{{ eoi_image }}:{{ eoi_version }}"
    state: started
    restart_policy: always
    ports:
    - "{{ eoi_port }}:3030"
    env:
      APKS: "{{ eoi_apks }}"
      GEMS: "{{ eoi_gems }}"
      WIDGETS: "{{ eoi_widgets }}"

- name: clean eyesofindicator git project
  file: 
    path: "{{ eoi_repo_dir }}"
    state: absent